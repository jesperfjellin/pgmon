services:
  dev:
    build:
      context: .
      target: dev
    env_file:
      - .env
    working_dir: /workspace
    command: ["bash"]
    volumes:
      - .:/workspace
      - cargo-registry:/usr/local/cargo/registry
      - cargo-git:/usr/local/cargo/git
      - target-cache:/workspace/target

  pgmon:
    build:
      context: .
      target: runtime
    image: pgmon:local
    env_file:
      - .env
    ports:
      - "8181:8181"
    volumes:
      - ./config.pgmon.yaml:/config/pgmon.yaml:ro

volumes:
  cargo-registry:
  cargo-git:
  target-cache:
